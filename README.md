# 微生共鳴曼荼羅 – Interactive Web Art (p5.js)

> デジタル祖霊の「声」に呼応して、**微生物コロニー**のような反応拡散の紋様が**曼荼羅**として生成・変容する、ブラウザで鑑賞可能なインタラクティブ作品。

- **URL / 配布**: 静的ファイルのみ（`index.html`, `style.css`, `sketch.js`）。CDN の p5.js を利用し、追加のビルド不要。
- **動作要件**: 最新の Chrome / Edge / Firefox。カメラ・マイク使用のため **HTTPS** または `http://localhost` での配信が必要。

---

## 1. 作品の目的と体験（仕様要約）

- 視覚化の核：**反応拡散（Gray–Scott）**により、生命的な斑点・縞の成長を生成。
- 形態：**曼荼羅（円環×回転対称）**で全体構成。回路（PCB）風のフラクタル線画を有機層に融合。
- 共鳴：**マイク音声**から得たエネルギー／簡易感情（Valence/Arousal）、**カメラの動き**から得た GrowthIndex を、パターン速度・色彩・輝度・グローに反映。
- 流動：**Perlin ノイズのフロー場**に沿って粒子群が渦を巻き、全体の一体感を演出。
- インタラクション：**マウスで種を撒く**と RD 増殖、**キーボード**でモード・対称数操作、**録画/保存**が可能。

---

## 2. ファイル構成
├─ index.html      # エントリ（p5.js & p5.sound CDN / UI / HUD）
├─ style.css       # UI スタイル（HUD / オーバレイ / グラス感）
├─ sketch.js       # p5.js スケッチ（シミュレーションと合成）
└─ .env.example    # 未来の外部API利用用のテンプレ（本作は未使用）


> **外部 API について**
> 本実装は **外部 API を使用しません**（すべてクライアント内）。
> もし将来的に音声認識や感情分析 API を接続する場合は、`.env` をテンプレに従って用意し、フロントが直接秘匿情報を持たないよう**必ずサーバ側プロキシ**を介してください（クライアント直埋めは危険です）。

---

## 3. 実行方法（ローカル / デプロイ）

### ローカルで体験
1. このフォルダに移動して、簡易サーバで配信（どちらか）
   - Python: `python3 -m http.server 5173`
   - Node (serve): `npx serve -p 5173`
2. ブラウザで `http://localhost:5173` を開く。
3. **「はじめる」**を押して、マイク・カメラを許可。

> `file://` ではカメラ・マイクが動作しません。**HTTPS** または `localhost` が必要です。

### 静的ホスティング
- GitHub Pages / Netlify / Vercel 等にフォルダごとアップロードで動作します。
  カメラ・マイクは **HTTPS** でのみ許可されます。

---

## 4. 操作・インタラクション

- **クリック or スペース**：許可ダイアログ → 体験開始
- **マウスドラッグ**：中心付近に**種（V注入）**を撒き、反応拡散が増殖
- **← / →**：曼荼羅の分割数（回転対称数）を増減
- **1 / 2 / 3**：モード（観察 / 描画 / 祖霊）切替
- **H**：HUD 表示切替
- **S**：PNG スナップショット保存
- **R**：録画（20 秒）。再度 R で早期停止も可

**すぐ効くリアクション**
- 囁く・静かな環境：**寒色系**に寄り、静謐な輝き
- 高揚・笑い声：**暖色系**＋**強めのグロー**、外環がきらめく
- カメラ前で手を動かす：**GrowthIndex** 上昇 → 斑点の増殖が活発化

---

## 5. 技術仕様（実装詳細）

### 5.1 レンダリング・合成
- p5.js `WEBGL` / シェーダ（GLSL）
- **反応拡散**（Gray–Scott）を **2枚の ping-pong テクスチャ**で更新
  - `feed (f)` は GrowthIndex と高域エネルギーで変調
  - `kill (k)` は Arousal と |Valence| で変調
  - マウス位置近傍に V を注入（“種まき”）
- **曼荼羅合成**：極座標で回転対称・ミラー対称化し、RD をタイル
- **色彩 / 輝度**：Valence → **色相**（青紫↔赤橙）、Arousal → **明度・グロー**
- **フロー場**：Perlin ノイズのベクトル場で 2,800 粒子が流動（画面の背景）
- **ポスト**：簡易 Bloom（ガウシアン BLUR + 加算）、PCB 風オーバレイ

### 5.2 入力解析
- **マイク**（Web Audio / p5.sound）
  - FFT バンド：`low(20–160Hz)`, `mid(160–2kHz)`, `high(2–8kHz)`
  - `Arousal` = 音量由来（`rms`） / `Valence` = `high - low` を簡易指標
- **カメラ**（getUserMedia）
  - 低解像度バッファで**フレーム差分** → 平均差分を **GrowthIndex** として RD の `feed` を変調
- **モード**（観察/描画/祖霊）
  - 音・カメラ・ブラシの影響重みを切替（エクスプレッシブさの快適調整）

---

## 6. パフォーマンス・適応
- 目標 60FPS（端末により 30–60FPS を想定）
- RD 解像度：`512²`（負荷に応じて `rdRes` を `256`/`1024` に調整可）
- フロー粒子数や BLUR 強度は `FLOW_PARTICLES` / `FLOW_FADE` で調整

---

## 7. アクセシビリティ / プライバシー
- **明示許可**：開始時にマイク・カメラの許可 UI
- **ローカル処理**：音声・映像は**端末内のみ**で解析（送信なし）
- **低刺激モード**：HUD をオフ、グロー強度を低めに（`sketch.js` 内で調整）

---

## 8. 拡張ポイント（仕様書準拠の発展例）
- **Boids 群集**を GPU / CPU で追加し、外環の粒子を群れ行動へ
- **Kawase Bloom / ACES トーンマップ**でポストを強化（GLSL 追加）
- **顕微鏡 UVC カメラ選択** UI（`MediaDevices.enumerateDevices()`）
- **学習済み感情モデル（ONNX/TensorFlow.js）**を Worker で同梱（端末内推論）
- **録音音声の文字起こし & テキスト感情**（外部 API を**サーバ経由**で安全に）

---

## 9. トラブルシューティング
- **カメラ・マイクが動かない**
  → 必ず **HTTPS** か `http://localhost` で開いてください。
- **音に反応しない / 小さい**
  → OS/ブラウザのマイク権限と入力レベルを確認。外部マイク利用推奨。
- **重い**
  → `sketch.js` の `rdRes` を下げる、`FLOW_PARTICLES` を減らす、ウィンドウサイズを小さくする。

---

## 10. ライセンス
このプロジェクトのコードは、あなたの制作に自由に組み込める前提で提供しています。クレジット表記は任意ですが歓迎します。

